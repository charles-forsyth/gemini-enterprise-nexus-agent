# Nexus Agent Development Plan

**Goal:** Build a Google ADK agent that provides a natural language interface to the `nexus` CLI, deployable to Gemini Enterprise.

---

## Phase 1: Foundation (Current)
- [x] Research Google ADK framework.
- [x] Initialize project with `uv` and `google-adk`.
- [x] Verify basic "Hello World" agent calling `nexus`.
- [ ] Implement robust error handling for CLI calls.

---

## Phase 2: Tool Implementation
Wrap key `nexus` commands as Python tools for the agent. Each tool will use `subprocess` to execute the CLI and return the output.

### 1. Discovery Tools
- `nexus_search(term: str)`: Fuzzy and semantic search for entities.
- `nexus_dossier(netid: str)`: Detailed profile for a researcher.
- `nexus_tree(term: str)`: Visualize relationships.

### 2. Intelligence Tools
- `nexus_briefing()`: Get the Daily Intelligence Briefing.
- `nexus_ship_status()`: Scan for cold relationships (Relationship Health).
- `nexus_stats()`: Show KPIs and scoreboard.

### 3. Operational Tools
- `nexus_tasks_list()`: List open operational tasks.
- `nexus_interactions_show(id: str)`: View specific interaction details.

---

## Phase 3: Multi-Agent Orchestration
Leverage ADK's composition patterns to handle complex workflows.

- **Manager Agent:** The entry point for the user.
- **Workflow Agents:**
    - Use `ParallelAgent` to gather data from multiple `nexus` subcommands at once (e.g., "Get stats and briefing").
    - Use `SequentialAgent` for multi-step processes (e.g., "Find researcher netid, then pull dossier").

---

## Phase 4: Session & State Management
- Use `session.state` to track the current entity being discussed (e.g., "Tell me more about *them*").
- Integrate with `digital_me.db` (Read-only) if cross-referencing is needed for personal context.

---

## Phase 5: Deployment & Gemini Enterprise Integration

To move from local testing to the Gemini Enterprise workspace, follow these specific steps:

### 1. Containerize & Push
- **Build:** Use the provided `Dockerfile`.
- **Registry:** Push the image to Google Artifact Registry (GAR).
    ```bash
    gcloud builds submit --tag gcr.io/[PROJECT_ID]/nexus-agent .
    ```

### 2. Deploy to Cloud Run (Agent Engine)
- **Deploy:** Deploy the container as a Cloud Run service.
- **Port:** Ensure it listens on `8080`.
- **IAM:** Grant the `Cloud Run Invoker` role to the service account used by Gemini Enterprise.
- **Environment:** Ensure the `NEXUS_DB_PATH` or relevant environment variables are set (or mount the database volume).

### 3. Configure OAuth 2.0
Gemini Enterprise requires OAuth to securely communicate with your agent.
- **OAuth Client:** Create an OAuth 2.0 Client ID in the Google Cloud Console (APIs & Services -> Credentials).
- **ADK Auth:** The ADK framework handles the handshake. Ensure `main.py` is configured to validate the incoming tokens from the GE environment.

### 4. Register in Gemini Enterprise
Navigate to the [Gemini Enterprise Agent Console](https://vertexaisearch.cloud.google.com/us/home/cid/74934e12-7960-462b-a548-72a31a17e03b?hl=en_US) and follow these steps:
1.  **Create Agent:** Click "Create" and select "External Agent" (or similar ADK-compatible option).
2.  **API Endpoint:** Provide the URL of your deployed Cloud Run service.
3.  **Authentication:** Enter the OAuth Client ID and Secret generated in Step 3.
4.  **Schema/Manifest:** Upload the `agent_manifest.json` (auto-generated by ADK or manually defined) which describes the `nexus_search`, `nexus_briefing`, etc., tools.
5.  **Enable:** Toggle the agent to "Enabled" for your workspace.

### 5. Final Verification in GE
- Open the Gemini Enterprise web interface.
- Invoke the agent using its registered name (e.g., `@nexus-agent`).
- Test a command: `@nexus-agent Captain needs the daily briefing.`

---

## Security & Integrity
- **Non-Destructive:** All operations will be read-only or use the established `nexus` CLI logic (which has its own validations).
- **No Direct DB Access:** The agent interacts strictly with the `nexus` CLI to maintain the "System of Record" architecture.
